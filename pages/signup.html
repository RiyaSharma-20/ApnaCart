<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title> ApnaCart - Signup / Login -</title>
  <link rel="stylesheet" href="../css/index.css">
<link rel="stylesheet" href="../css/bag.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />

  <style>

    /* Center only the profile box */
    .auth-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 70vh;
      padding: 2rem;
    }
    .auth-box {
      background: #fff;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
    }
    .auth-box h2 {
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }
    .auth-box input {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .auth-box button {
      width: 100%;
      padding: 12px;
      background: #2ecc71;
      border: none;
      color: #fff;
      font-weight: bold;
      border-radius: 6px;
      margin-top: 10px;
      cursor: pointer;
    }
    .auth-box button:hover {
      background: #27ae60;
    }
    .auth-box p {
      text-align: center;
      margin-top: 15px;
    }
    .profile-box {
      text-align: left;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo_container">
      <a href="index.html" class="brand-link" aria-label="ApnaCart Home">
        <img class="brand_logo" src="../images/apnacart-logo.svg" alt="ApnaCart Logo" />
      </a>
    </div>
    <nav class="nav_bar" aria-label="Primary">
      <a href="../index.html">Men</a>
      <a href="../index.html">Women</a>
      <a href="../index.html">Electronics</a>
      <a href="../index.html">Home</a>
      <a href="../index.html">Beauty</a>
      <a href="../index.html" class="pill">Deals</a>
    </nav>
    <div class="search_bar" role="search">
      <span class="material-symbols-outlined search_icon">search</span>
      <input class="search_input" placeholder="Search on ApnaCart…" aria-label="Search products" />
    </div>
    <div class="action_bar">
      <a class="action_container" href="../pages/signup.html" id="profileLink">
        <span class="material-symbols-outlined action_icon">person</span>
        <span class="action_name">Profile</span>
      </a>

      <div class="action_container">
        <span class="material-symbols-outlined action_icon">favorite</span>
        <span class="action_name">Wishlist</span>
      </div>
      <a class="action_container" href="../pages/bag.html">
        <span class="material-symbols-outlined action_icon">shopping_bag</span>
        <span class="action_name">Bag</span>
        <span class="bag-item-count">0</span>
      </a>
    </div>
  </header>
  <main>
    <section class="auth-section">
      <div class="auth-box" id="auth-box">
        <!-- JS will inject content here -->
      </div>
    </section>
  </main>

  <script>
    const cartMsg = localStorage.getItem("cartMessage");
    if (cartMsg) {
      alert(cartMsg);
      localStorage.removeItem("cartMessage");
    }

    const container = document.getElementById("auth-box");

    // Check if user already registered
    const userData = JSON.parse(localStorage.getItem("user"));

    if (!userData) {
      // Show signup form
      container.innerHTML = `
        <h2>Sign Up</h2>
        <form id="signupForm">
          <input type="text" name="name" placeholder="Full Name" required>
          <input type="email" name="email" placeholder="Email" required>
          <input type="password" name="password" placeholder="Password" required>
          <input type="text" name="city" placeholder="City" required>
          <button type="submit">Register</button>
        </form>
        <p>Already registered? <a href="#" onclick="showLogin()">Login here</a></p>
      `;
      document.getElementById("signupForm").addEventListener("submit", function(e){
        e.preventDefault();
        const formData = new FormData(this);
        const newUser = {
          name: formData.get("name"),
          email: formData.get("email"),
          password: formData.get("password"),
          city: formData.get("city")
        };
        localStorage.setItem("user", JSON.stringify(newUser));
        alert("Signup successful! Redirecting to home...");

        localStorage.setItem("redirectAfterLogin", "home");
        window.location.href = "../index.html";
      });
    } else {
      showLogin();
    }

    // Show login form
    function showLogin() {
      container.innerHTML = `
        <h2>Login</h2>
        <form id="loginForm">
          <input type="email" name="email" placeholder="Email" required>
          <input type="password" name="password" placeholder="Password" required>
          <button type="submit">Login</button>
        </form>
      `;
      document.getElementById("loginForm").addEventListener("submit", function(e){
        e.preventDefault();
        const formData = new FormData(this);
        const email = formData.get("email");
        const password = formData.get("password");
        const storedUser = JSON.parse(localStorage.getItem("user"));

        if (storedUser && storedUser.email === email && storedUser.password === password) {
        const redirect = localStorage.getItem("redirectAfterLogin");
        const intendedItem = localStorage.getItem("intendedItem");

        if (redirect === "home") {
          localStorage.removeItem("redirectAfterLogin");

          // Auto-add item if user clicked Add to Cart before login
          if (intendedItem) {
            let bagItems = JSON.parse(localStorage.getItem("bagItems")) || [];
            bagItems.push(intendedItem);
            localStorage.setItem("bagItems", JSON.stringify(bagItems));
            localStorage.removeItem("intendedItem");
          }

          window.location.href = "../index.html"; // ✅ back to home
        } 
        else {
          showProfile(storedUser);
        }
      }
      else {
        alert("Invalid credentials. Try again.");
      }
      });
    }

    // Show profile page
  function showProfile(user) {
  const container = document.getElementById("auth-box");

  container.innerHTML = `
    <h2>My Profile</h2>
    <p><strong>Name:</strong> ${user.name}</p>
    <p><strong>Email:</strong> ${user.email}</p>
    <p><strong>City:</strong> ${user.city}</p>
    <button id="logoutBtn" class="btn">Logout</button>
  `;

  // ✅ Add event listener to logout button
  document.getElementById("logoutBtn").addEventListener("click", () => {
    localStorage.removeItem("user");      // clear user
    localStorage.removeItem("bagItems");  // optional: clear cart
    alert("Logged Out successfully!");
    window.location.href = "../index.html"; // back to home
  });
}
  
  document.addEventListener("DOMContentLoaded", () => {
  const storedUser = JSON.parse(localStorage.getItem("user"));
  if (storedUser) {
    // ✅ If already logged in, skip login form and show profile directly
    showProfile(storedUser);
  }
});


  </script>
</body>
</html>
